name: Deferred Shading
description: Deferred Shading, with HDR postprocessing and FXAA

rendertargets:
  GeometryBuffer:
    NormalsMaterial:
      size: 1.0, 1.0
      format: RGBA_Float16
    DiffuseAlbedo:
      size: 1.0, 1.0
      format: RGBA_UInt8
    ZBuffer:
      size: 1.0, 1.0
      format: Depth32
  ForwardBuffer:
    Color:
      size: 1.0, 1.0
      format: RGBA_Float32
  DSSDOBuffer:
    Occlusion:
      size: 0.5, 0.5
      format: RGBA_UInt8
  DSSDOTemp1:
    Occlusion:
      size: 0.5, 0.5
      format: RGBA_UInt8
  DSSDOTemp2:
    Occlusion:
      size: 0.5, 0.5
      format: RGBA_UInt8
  HDRBuffer:
    Color:
      size: 1.0, 1.0
      format: RGBA_Float32
    Depth:
      size: 1.0, 1.0
      format: Depth32
  FXAABuffer:
    Color:
      size: 1.0, 1.0
      format: RGBA_UInt8

renderpasses:
  Scene:
    type: geometry
    renderTransparent: false
    renderOpaque: true
    shaders:
      - "DefaultDeferred.vert.spv"
      - "DefaultDeferred.frag.spv"
    output: GeometryBuffer
  DSSDO:
    type: quad
    parameters:
      Global.displayWidth: 0
      Global.displayHeight: 0
      ssaoRadius: 0.5
      ssaoSamples: 16
      maxDistance: 0.2
    shaders:
      - "FullscreenQuad.vert.spv"
      - "DSSDO.frag.spv"
    inputs:
      - GeometryBuffer.NormalsMaterial
      - GeometryBuffer.ZBuffer
    output: DSSDOTemp1
  DSSDOBlurV:
    type: quad
    parameters:
      Global.displayWidth: 0
      Global.displayHeight: 0
      Direction: 0.0, 1.0
    shaders:
      - "FullscreenQuad.vert.spv"
      - "DSSDOBlur.frag.spv"
    inputs:
      - GeometryBuffer.NormalsMaterial
      - DSSDOTemp1
    output: DSSDOTemp2
  DSSDOBlurH:
    type: quad
    parameters:
      Global.displayWidth: 0
      Global.displayHeight: 0
      Direction: 1.0, 0.0
    shaders:
      - "FullscreenQuad.vert.spv"
      - "DSSDOBlur.frag.spv"
    inputs:
      - GeometryBuffer.NormalsMaterial
      - DSSDOTemp2
    output: DSSDOBuffer
  DeferredLighting:
    type: lights
    renderTransparent: true
    renderOpaque: false
    depthWriteEnabled: false
    depthTestEnabled: false
    shaders:
      - "DeferredLighting.vert.spv"
      - "DeferredLighting.frag.spv"
    inputs:
      - GeometryBuffer
      - DSSDOBuffer
    output: ForwardBuffer
    parameters:
      debugLights: 0
      reflectanceModel: 0
      Global.displayWidth: 0
      Global.displayHeight: 0
  ForwardShading:
    type: geometry
    renderTransparent: true
    renderOpaque: false
    blitInputs: true
    shaders:
      - "DefaultForward.vert.spv"
      - "DefaultForward.frag.spv"
    inputs:
      - ForwardBuffer.Color
      - GeometryBuffer.ZBuffer
    output: HDRBuffer
  HDR:
    type: quad
    shaders:
      - "FullscreenQuad.vert.spv"
      - "HDR.frag.spv"
    inputs:
      - HDRBuffer.Color
    output: FXAABuffer
    parameters:
      TonemappingOperator: 0
      Gamma: 2.2
      Exposure: 10.0
      WhitePoint: 11.2
  FXAA:
    type: quad
    shaders:
      - "FullscreenQuad.vert.spv"
      - "FXAA.frag.spv"
    parameters:
      activateFXAA: 1
      showEdges: 0
      lumaThreshold: 0.125
      minLumaThreshold: 0.02
      mulReduce: 0.125
      minReduce: 0.0078125
      maxSpan: 8.0
      Global.displayWidth: 0
      Global.displayHeight: 0
    inputs:
      - FXAABuffer
    output: Viewport
